<!DOCTYPE html>
<html>
<head>
    <title>Your Cart</title>
</head>
<body>
    <h1>Your Shopping Cart</h1>
    {% if cart_products %}
        <table>
            <tr>
                <th>Product</th>
                <th>Quantity</th>
                <th>Subtotal</th>
                <th>Action</th>
            </tr>
            {% for item in cart_products %}
            <tr>
                <td>{{ item.product.name }}</td>
                <td>
                    <form action="{% url 'update_cart' item.product.id %}" method="post">
                        {% csrf_token %}
                        <input type="number" name="quantity" value="{{ item.quantity }}" min="1">
                        <button type="submit">Update</button>
                    </form>
                </td>
                <td>${{ item.subtotal }}</td>
                <td><a href="{% url 'remove_from_cart' item.product.id %}">Remove</a></td>
            </tr>
            {% endfor %}
        </table>

        <p>Subtotal: ${{ total_price }}</p>
        {% if discount_percent %}
            <p>Discount ({{ discount_percent }}%): -${{ discount_amount }}</p>
        {% endif %}
        <p>Price after Discount: ${{ price_after_discount }}</p>
        <p>Tax ({{ TAX_RATE|floatformat:0 }}%): ${{ tax_amount }}</p>
        <p>Shipping: ${{ shipping_cost }}</p>
        <p><strong>Final Total: ${{ final_total }}</strong></p>

        <form action="{% url 'apply_discount' %}" method="post">
            {% csrf_token %}
            <input type="text" name="code" placeholder="Discount code">
            <button type="submit">Apply</button>
        </form>
    {% else %}
        <p>Your cart is empty.</p>
    {% endif %}
</body>
</html>
